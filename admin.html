<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin ¬∑ Budget Homes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --ink: #0d0d0d;
      --paper: #f5f2eb;
      --gold: #b8942a;
      --gold-light: #d4a93a;
      --gold-pale: #f5edda;
      --rule: #d6cdb8;
      --success: #2d6a4f;
      --success-bg: #d8f3dc;
      --error: #9b2226;
      --error-bg: #fde8e8;
      --mono: 'DM Mono', monospace;
      --serif: 'Cormorant Garamond', Georgia, serif;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--mono);
      background: var(--paper);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ‚îÄ‚îÄ Login Screen ‚îÄ‚îÄ */
    #loginScreen {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background:
        repeating-linear-gradient(0deg, transparent, transparent 39px, var(--rule) 39px, var(--rule) 40px),
        repeating-linear-gradient(90deg, transparent, transparent 39px, var(--rule) 40px, var(--rule) 41px);
    }

    .login-card {
      background: white;
      border: 1.5px solid var(--ink);
      padding: 3rem 2.5rem;
      width: 100%;
      max-width: 380px;
      box-shadow: 6px 6px 0 var(--ink);
      position: relative;
    }

    .login-card::before {
      content: 'RESTRICTED';
      position: absolute;
      top: -12px;
      left: 20px;
      background: var(--gold);
      color: white;
      font-size: 0.6rem;
      font-weight: 500;
      letter-spacing: 0.15em;
      padding: 2px 10px;
    }

    .login-logo {
      font-family: var(--serif);
      font-size: 2rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      margin-bottom: 0.25rem;
    }
    .login-logo span { color: var(--gold); }

    .login-sub {
      font-size: 0.72rem;
      letter-spacing: 0.08em;
      color: #777;
      margin-bottom: 2rem;
      text-transform: uppercase;
    }

    .field-label {
      display: block;
      font-size: 0.68rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #555;
      margin-bottom: 0.4rem;
    }

    input[type="password"] {
      width: 100%;
      border: 1.5px solid var(--ink);
      background: var(--paper);
      font-family: var(--mono);
      font-size: 0.9rem;
      padding: 0.65rem 0.9rem;
      outline: none;
      transition: border-color 0.15s;
      letter-spacing: 0.1em;
    }
    input[type="password"]:focus { border-color: var(--gold); background: white; }

    .login-err {
      font-size: 0.72rem;
      color: var(--error);
      margin-top: 0.5rem;
      min-height: 1.2em;
    }

    .btn-login {
      display: block;
      width: 100%;
      margin-top: 1.5rem;
      background: var(--ink);
      color: white;
      border: none;
      font-family: var(--mono);
      font-size: 0.78rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      padding: 0.75rem;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }
    .btn-login:hover { background: var(--gold); }
    .btn-login:active { transform: scale(0.98); }

    /* ‚îÄ‚îÄ Admin Panel ‚îÄ‚îÄ */
    #adminPanel { display: none; flex: 1; flex-direction: column; }
    #adminPanel.active { display: flex; }

    header.admin-header {
      background: var(--ink);
      color: white;
      padding: 0 2rem;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-brand {
      font-family: var(--serif);
      font-size: 1.25rem;
      font-weight: 600;
    }
    .header-brand span { color: var(--gold-light); }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .header-tag {
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: #aaa;
    }

    .btn-logout {
      background: transparent;
      border: 1px solid #555;
      color: #bbb;
      font-family: var(--mono);
      font-size: 0.68rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 0.35rem 0.9rem;
      cursor: pointer;
      transition: border-color 0.15s, color 0.15s;
    }
    .btn-logout:hover { border-color: var(--gold); color: var(--gold-light); }

    .admin-body {
      flex: 1;
      padding: 2.5rem 2rem;
      max-width: 820px;
      margin: 0 auto;
      width: 100%;
    }

    .page-title {
      font-family: var(--serif);
      font-size: 2.2rem;
      font-weight: 400;
      font-style: italic;
      color: var(--ink);
      margin-bottom: 0.25rem;
    }
    .page-desc {
      font-size: 0.72rem;
      color: #777;
      letter-spacing: 0.06em;
      margin-bottom: 2.5rem;
    }

    /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
    #saveToast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: var(--ink);
      color: white;
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      padding: 0.75rem 1.5rem;
      border-left: 3px solid var(--gold);
      box-shadow: 4px 4px 0 var(--gold);
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      white-space: nowrap;
      z-index: 999;
    }
    #saveToast.show { transform: translateX(-50%) translateY(0); }

    /* ‚îÄ‚îÄ Price Cards ‚îÄ‚îÄ */
    .section-rule {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.25rem;
    }
    .section-rule-label {
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--gold);
      white-space: nowrap;
    }
    .section-rule-line {
      flex: 1;
      height: 1px;
      background: var(--rule);
    }

    .price-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1rem;
      margin-bottom: 2.5rem;
    }

    .price-card {
      border: 1.5px solid var(--rule);
      background: white;
      padding: 1.4rem 1.25rem 1.25rem;
      position: relative;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .price-card:hover {
      border-color: var(--gold);
      box-shadow: 3px 3px 0 var(--gold-pale);
    }
    .price-card.pg-card {
      border-color: var(--gold);
      background: var(--gold-pale);
    }

    .card-badge {
      position: absolute;
      top: -1px;
      left: 1rem;
      transform: translateY(-50%);
      background: var(--ink);
      color: white;
      font-size: 0.6rem;
      font-weight: 500;
      letter-spacing: 0.14em;
      padding: 2px 8px;
    }
    .pg-card .card-badge { background: var(--gold); }

    .card-name {
      font-family: var(--serif);
      font-size: 1.05rem;
      font-weight: 600;
      margin-top: 0.5rem;
      margin-bottom: 0.2rem;
    }
    .card-type {
      font-size: 0.65rem;
      letter-spacing: 0.1em;
      color: #888;
      text-transform: uppercase;
      margin-bottom: 1rem;
    }

    .price-input-wrap {
      display: flex;
      align-items: center;
      border: 1.5px solid var(--ink);
      background: var(--paper);
      overflow: hidden;
      transition: border-color 0.15s;
    }
    .price-input-wrap:focus-within { border-color: var(--gold); background: white; }

    .currency-sym {
      padding: 0 0.6rem;
      font-family: var(--serif);
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--gold);
      border-right: 1px solid var(--rule);
      user-select: none;
    }

    input[type="number"] {
      flex: 1;
      border: none;
      background: transparent;
      font-family: var(--mono);
      font-size: 1.05rem;
      font-weight: 500;
      padding: 0.55rem 0.7rem;
      outline: none;
      color: var(--ink);
      -moz-appearance: textfield;
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }

    .price-unit {
      padding: 0 0.6rem;
      font-size: 0.62rem;
      letter-spacing: 0.08em;
      color: #999;
      border-left: 1px solid var(--rule);
      white-space: nowrap;
      user-select: none;
    }

    /* ‚îÄ‚îÄ Notes section ‚îÄ‚îÄ */
    .notes-box {
      border: 1.5px solid var(--rule);
      background: white;
      padding: 1.5rem;
      margin-bottom: 2.5rem;
    }
    .notes-title {
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 0.75rem;
    }
    .notes-box textarea {
      width: 100%;
      border: 1.5px solid var(--rule);
      background: var(--paper);
      font-family: var(--mono);
      font-size: 0.8rem;
      padding: 0.65rem 0.9rem;
      resize: vertical;
      min-height: 80px;
      outline: none;
      color: var(--ink);
      line-height: 1.5;
      transition: border-color 0.15s;
    }
    .notes-box textarea:focus { border-color: var(--gold); background: white; }

    /* ‚îÄ‚îÄ Save Bar ‚îÄ‚îÄ */
    .save-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 1rem 1.5rem;
      background: white;
      border: 1.5px solid var(--rule);
      margin-bottom: 2rem;
    }

    .save-info {
      font-size: 0.68rem;
      color: #888;
      letter-spacing: 0.05em;
    }
    .save-info strong { color: var(--ink); }

    .btn-save {
      background: var(--gold);
      color: white;
      border: none;
      font-family: var(--mono);
      font-size: 0.78rem;
      font-weight: 500;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      padding: 0.7rem 2rem;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    }
    .btn-save:hover {
      background: #9a7a1e;
      box-shadow: 3px 3px 0 var(--ink);
    }
    .btn-save:active { transform: scale(0.97); }

    .btn-reset {
      background: transparent;
      border: 1.5px solid var(--rule);
      color: #888;
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 0.7rem 1.25rem;
      cursor: pointer;
      transition: border-color 0.15s, color 0.15s;
    }
    .btn-reset:hover { border-color: var(--error); color: var(--error); }

    /* ‚îÄ‚îÄ Status indicator ‚îÄ‚îÄ */
    .status-dot {
      display: inline-block;
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #ccc;
      margin-right: 5px;
      vertical-align: middle;
    }
    .status-dot.saved { background: var(--success); }

    /* ‚îÄ‚îÄ Preview pane ‚îÄ‚îÄ */
    .preview-box {
      border: 1.5px dashed var(--rule);
      padding: 1.5rem;
      background: #fafafa;
      margin-bottom: 3rem;
    }
    .preview-title {
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: #aaa;
      margin-bottom: 1rem;
    }
    .preview-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem 1.5rem;
    }
    .preview-item {
      font-size: 0.78rem;
      color: #555;
    }
    .preview-item strong {
      color: var(--ink);
      font-weight: 500;
    }
    .preview-price {
      color: var(--gold);
      font-weight: 500;
    }

    /* ‚îÄ‚îÄ Instructions ‚îÄ‚îÄ */
    .howto {
      border-top: 1px solid var(--rule);
      padding-top: 1.5rem;
      margin-bottom: 3rem;
    }
    .howto-title {
      font-family: var(--serif);
      font-size: 1.1rem;
      font-style: italic;
      margin-bottom: 0.75rem;
    }
    .howto p {
      font-size: 0.75rem;
      line-height: 1.7;
      color: #666;
      margin-bottom: 0.5rem;
    }
    .howto code {
      background: var(--paper);
      border: 1px solid var(--rule);
      padding: 1px 6px;
      font-family: var(--mono);
      font-size: 0.72rem;
    }

    /* ‚îÄ‚îÄ Forgot password link ‚îÄ‚îÄ */
    .btn-forgot {
      display: block;
      width: 100%;
      margin-top: 0.75rem;
      background: transparent;
      border: none;
      font-family: var(--mono);
      font-size: 0.7rem;
      color: #aaa;
      cursor: pointer;
      letter-spacing: 0.05em;
      text-decoration: underline;
      text-underline-offset: 3px;
      padding: 0.25rem 0;
    }
    .btn-forgot:hover { color: var(--gold); }

    /* ‚îÄ‚îÄ Change password header button ‚îÄ‚îÄ */
    .btn-changepw {
      background: transparent;
      border: 1px solid #444;
      color: #ccc;
      font-family: var(--mono);
      font-size: 0.68rem;
      letter-spacing: 0.08em;
      padding: 0.35rem 0.9rem;
      cursor: pointer;
      transition: border-color 0.15s, color 0.15s;
    }
    .btn-changepw:hover { border-color: var(--gold-light); color: var(--gold-light); }

    /* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      z-index: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      backdrop-filter: blur(2px);
    }
    .modal-card {
      background: white;
      border: 1.5px solid var(--ink);
      padding: 2rem 2rem 1.75rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 6px 6px 0 var(--ink);
      animation: modalIn 0.2s ease;
    }
    @keyframes modalIn {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .modal-title {
      font-family: var(--serif);
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1.25rem;
    }
    .modal-input {
      width: 100%;
      border: 1.5px solid var(--ink);
      background: var(--paper);
      font-family: var(--mono);
      font-size: 0.88rem;
      padding: 0.65rem 0.9rem;
      outline: none;
      transition: border-color 0.15s;
      display: block;
    }
    .modal-input:focus { border-color: var(--gold); background: white; }
    .modal-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      margin-top: 1.25rem;
    }

    /* ‚îÄ‚îÄ Recovery key display ‚îÄ‚îÄ */
    .recovery-key-box {
      background: var(--ink);
      color: var(--gold-light);
      font-family: var(--mono);
      font-size: 1.1rem;
      font-weight: 500;
      letter-spacing: 0.18em;
      text-align: center;
      padding: 1rem;
      border: 2px solid var(--gold);
      margin-bottom: 0.75rem;
      user-select: all;
    }
    .btn-copy {
      display: block;
      width: 100%;
      background: transparent;
      border: 1.5px solid var(--rule);
      font-family: var(--mono);
      font-size: 0.72rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 0.5rem;
      cursor: pointer;
      color: #888;
      transition: border-color 0.15s, color 0.15s;
    }
    .btn-copy:hover { border-color: var(--gold); color: var(--gold); }

    /* ‚îÄ‚îÄ Gallery Manager ‚îÄ‚îÄ */
    .gallery-admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.25rem;
    }

    .gallery-admin-card {
      border: 1.5px solid var(--rule);
      background: white;
      position: relative;
      overflow: hidden;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .gallery-admin-card:hover { border-color: var(--gold); box-shadow: 3px 3px 0 var(--gold-pale); }

    .gallery-admin-card .card-num {
      position: absolute;
      top: 8px;
      left: 8px;
      background: var(--ink);
      color: white;
      font-size: 0.6rem;
      letter-spacing: 0.12em;
      padding: 2px 7px;
      z-index: 2;
    }

    .gallery-admin-card .card-remove {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--error);
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      font-size: 0.8rem;
      cursor: pointer;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.15s;
    }
    .gallery-admin-card:hover .card-remove { opacity: 1; }

    .gallery-thumb-wrap {
      width: 100%;
      aspect-ratio: 4/3;
      overflow: hidden;
      background: #eee;
      cursor: pointer;
      position: relative;
    }
    .gallery-thumb-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: opacity 0.2s;
    }
    .gallery-thumb-wrap .thumb-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.15s;
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      color: white;
      text-transform: uppercase;
    }
    .gallery-thumb-wrap:hover .thumb-overlay { opacity: 1; }

    .gallery-card-body {
      padding: 0.75rem;
    }
    .gallery-alt-input {
      width: 100%;
      border: 1px solid var(--rule);
      background: var(--paper);
      font-family: var(--mono);
      font-size: 0.7rem;
      padding: 0.4rem 0.55rem;
      outline: none;
      color: var(--ink);
      transition: border-color 0.15s;
    }
    .gallery-alt-input:focus { border-color: var(--gold); background: white; }
    .gallery-alt-label {
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #aaa;
      margin-bottom: 0.3rem;
      display: block;
    }

    .gallery-add-btn {
      border: 1.5px dashed var(--rule);
      background: transparent;
      width: 100%;
      aspect-ratio: 4/3;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #bbb;
      font-family: var(--mono);
      font-size: 0.72rem;
      letter-spacing: 0.08em;
      gap: 0.5rem;
      transition: border-color 0.15s, color 0.15s, background 0.15s;
    }
    .gallery-add-btn:hover { border-color: var(--gold); color: var(--gold); background: var(--gold-pale); }
    .gallery-add-btn svg { opacity: 0.5; }
    .gallery-add-btn:hover svg { opacity: 1; }

    .gallery-save-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 1rem 1.5rem;
      background: white;
      border: 1.5px solid var(--rule);
      margin-bottom: 2.5rem;
    }

    /* ‚îÄ‚îÄ Edit Photo Modal ‚îÄ‚îÄ */
    .modal-card.wide { max-width: 520px; }
    .edit-tabs {
      display: flex;
      border-bottom: 1.5px solid var(--rule);
      margin-bottom: 1.25rem;
    }
    .edit-tab {
      font-family: var(--mono);
      font-size: 0.72rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 0.5rem 1.1rem;
      border: none;
      background: transparent;
      cursor: pointer;
      color: #aaa;
      border-bottom: 2px solid transparent;
      margin-bottom: -1.5px;
      transition: color 0.15s;
    }
    .edit-tab.active { color: var(--gold); border-bottom-color: var(--gold); }

    .tab-pane { display: none; }
    .tab-pane.active { display: block; }

    .upload-drop-zone {
      border: 2px dashed var(--rule);
      background: var(--paper);
      padding: 2rem 1rem;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.15s, background 0.15s;
      position: relative;
    }
    .upload-drop-zone:hover, .upload-drop-zone.drag-over {
      border-color: var(--gold);
      background: var(--gold-pale);
    }
    .upload-drop-zone input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      width: 100%;
      height: 100%;
    }
    .drop-label {
      font-size: 0.75rem;
      color: #888;
      line-height: 1.7;
    }
    .drop-label strong { color: var(--ink); display: block; font-size: 0.85rem; margin-bottom: 0.25rem; }

    .preview-thumb {
      width: 100%;
      max-height: 180px;
      object-fit: cover;
      display: none;
      margin-top: 0.75rem;
      border: 1px solid var(--rule);
    }
    .preview-thumb.show { display: block; }

    /* responsive */
    @media (max-width: 480px) {
      .admin-body { padding: 1.5rem 1rem; }
      .price-grid { grid-template-columns: 1fr 1fr; }
      .gallery-admin-grid { grid-template-columns: 1fr 1fr; }
      .save-bar { flex-direction: column; align-items: stretch; }
      .header-tag { display: none; }
      .btn-changepw { display: none; }
    }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="loginScreen">

  <!-- Normal login -->
  <div class="login-card" id="loginCard">
    <div class="login-logo">Budget <span>Homes</span></div>
    <div class="login-sub">Admin ¬∑ Price Manager</div>
    <label class="field-label" for="pwInput">Password</label>
    <input type="password" id="pwInput" placeholder="Enter admin password" autocomplete="current-password" />
    <div class="login-err" id="loginErr"></div>
    <button class="btn-login" id="loginBtn">Unlock Panel</button>
    <button class="btn-forgot" id="forgotBtn">Forgot password?</button>
  </div>

  <!-- Forgot / Reset password using recovery key -->
  <div class="login-card" id="resetCard" style="display:none;">
    <div class="login-logo">Budget <span>Homes</span></div>
    <div class="login-sub">Reset Password</div>
    <p style="font-size:0.72rem;color:#777;margin-bottom:1.25rem;line-height:1.6;">
      Enter your <strong>recovery key</strong> to set a new password.<br/>
      Your recovery key is shown once when you first set up the admin panel.
    </p>
    <label class="field-label" for="recoveryInput">Recovery Key</label>
    <input type="text" id="recoveryInput" placeholder="xxxx-xxxx-xxxx" autocomplete="off" style="width:100%;border:1.5px solid var(--ink);background:var(--paper);font-family:var(--mono);font-size:0.9rem;padding:0.65rem 0.9rem;outline:none;letter-spacing:0.1em;margin-bottom:1rem;" />
    <label class="field-label" for="newPwInput">New Password</label>
    <input type="password" id="newPwInput" placeholder="Enter new password" style="width:100%;border:1.5px solid var(--ink);background:var(--paper);font-family:var(--mono);font-size:0.9rem;padding:0.65rem 0.9rem;outline:none;letter-spacing:0.08em;margin-bottom:0.4rem;" />
    <label class="field-label" for="confirmPwInput" style="margin-top:0.75rem;">Confirm New Password</label>
    <input type="password" id="confirmPwInput" placeholder="Re-enter new password" style="width:100%;border:1.5px solid var(--ink);background:var(--paper);font-family:var(--mono);font-size:0.9rem;padding:0.65rem 0.9rem;outline:none;letter-spacing:0.08em;" />
    <div class="login-err" id="resetErr"></div>
    <button class="btn-login" id="doResetBtn" style="margin-top:1.25rem;">Set New Password</button>
    <button class="btn-forgot" id="backToLoginBtn">‚Üê Back to login</button>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="adminPanel">
  <header class="admin-header">
    <div class="header-brand">Budget <span>Homes</span></div>
    <div class="header-actions">
      <span class="header-tag">Price Manager</span>
      <button class="btn-changepw" id="changePwBtn">üîë Change Password</button>
      <button class="btn-logout" id="logoutBtn">Log out</button>
    </div>
  </header>

  <main class="admin-body">
    <h1 class="page-title">Manage Prices</h1>
    <p class="page-desc">Update room &amp; PG pricing. Changes apply to the website automatically.</p>

    <!-- Nightly Rates -->
    <div class="section-rule">
      <span class="section-rule-label">Nightly Rates</span>
      <div class="section-rule-line"></div>
    </div>

    <div class="price-grid" id="nightlyGrid">
      <!-- Cards injected by JS -->
    </div>

    <!-- PG Rate -->
    <div class="section-rule">
      <span class="section-rule-label">Paying Guest Rate</span>
      <div class="section-rule-line"></div>
    </div>

    <div class="price-grid" id="pgGrid"></div>

    <!-- Starting From note (hero/booking section) -->
    <div class="section-rule">
      <span class="section-rule-label">Website Display</span>
      <div class="section-rule-line"></div>
    </div>

    <div class="notes-box">
      <div class="notes-title">Hero &amp; Booking Section ‚Äî "Starting From" Price</div>
      <p style="font-size:0.72rem;color:#888;margin-bottom:0.75rem;">
        This price appears in the hero text and "Book Directly &amp; Save" section. Usually set to your lowest nightly rate.
      </p>
      <div class="price-input-wrap" style="max-width:240px;">
        <span class="currency-sym">‚Çπ</span>
        <input type="number" id="startingFrom" min="100" step="50" />
        <span class="price-unit">/ night ¬∑ from</span>
      </div>
    </div>

    <!-- Admin notes -->
    <div class="notes-box">
      <div class="notes-title">Private Admin Notes</div>
      <textarea id="adminNotes" placeholder="e.g. Peak season pricing active until Jan 31‚Ä¶"></textarea>
    </div>

    <!-- Save bar -->
    <div class="save-bar">
      <div class="save-info">
        <span class="status-dot" id="statusDot"></span>
        <span id="saveStatus">No unsaved changes</span>
      </div>
      <div style="display:flex;gap:0.75rem;align-items:center;">
        <button class="btn-reset" id="resetBtn">Reset to Defaults</button>
        <button class="btn-save" id="saveBtn">‚ú¶ Save All Prices</button>
      </div>
    </div>

    <!-- Live preview -->
    <div class="section-rule">
      <span class="section-rule-label">Live Preview</span>
      <div class="section-rule-line"></div>
    </div>
    <div class="preview-box">
      <div class="preview-title">Current saved prices (as shown on website)</div>
      <div class="preview-list" id="previewList"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- GALLERY MANAGER                                  -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="section-rule" style="margin-top:2.5rem;">
      <span class="section-rule-label">Gallery Photos</span>
      <div class="section-rule-line"></div>
    </div>
    <p class="page-desc" style="margin-bottom:1.25rem;">
      Manage the 8 photos shown in the Gallery section. Click any photo to replace it, edit its caption, or remove it. Drag to reorder.
    </p>

    <div class="gallery-admin-grid" id="galleryAdminGrid">
      <!-- Cards rendered by JS -->
    </div>

    <!-- Add photo button -->
    <div style="margin-bottom:1.25rem;" id="addPhotoWrap">
      <button class="gallery-add-btn" id="addPhotoBtn" style="max-width:200px;aspect-ratio:unset;padding:1rem 1.5rem;width:auto;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Add Photo
      </button>
    </div>

    <!-- Gallery Save bar -->
    <div class="gallery-save-bar">
      <div class="save-info">
        <span class="status-dot" id="galleryStatusDot"></span>
        <span id="galleryStatus">No unsaved changes</span>
      </div>
      <div style="display:flex;gap:0.75rem;">
        <button class="btn-reset" id="galleryResetBtn">Reset to Original</button>
        <button class="btn-save" id="gallerySaveBtn">‚ú¶ Save Gallery</button>
      </div>
    </div>

    <!-- Instructions -->
    <div class="howto">
      <div class="howto-title">How this works</div>
      <p>Prices and gallery changes are stored in your browser's local storage and applied to <code>index.html</code> automatically when <code>prices.js</code> is included in the page.</p>
      <p>To activate on your website, add this line just before the closing <code>&lt;/body&gt;</code> tag in <code>index.html</code>:</p>
      <p><code>&lt;script src="prices.js"&gt;&lt;/script&gt;</code></p>
      <p>Both <code>admin.html</code> and <code>index.html</code> must be on the same domain for changes to carry over.</p>
    </div>

  </main>
</div>

<!-- Toast -->
<div id="saveToast">‚ú¶ Prices saved successfully</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CHANGE PASSWORD MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="changePwModal" class="modal-backdrop" style="display:none;">
  <div class="modal-card">
    <div class="modal-title">Change Password</div>
    <label class="field-label" for="cpCurrent">Current Password</label>
    <input type="password" id="cpCurrent" placeholder="Enter current password" class="modal-input" />
    <label class="field-label" for="cpNew" style="margin-top:0.9rem;">New Password</label>
    <input type="password" id="cpNew" placeholder="Min 8 characters" class="modal-input" />
    <label class="field-label" for="cpConfirm" style="margin-top:0.9rem;">Confirm New Password</label>
    <input type="password" id="cpConfirm" placeholder="Re-enter new password" class="modal-input" />
    <div class="login-err" id="cpErr"></div>
    <div class="modal-actions">
      <button class="btn-reset" id="cpCancelBtn">Cancel</button>
      <button class="btn-save" id="cpSaveBtn">‚ú¶ Update Password</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RECOVERY KEY MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="recoveryModal" class="modal-backdrop" style="display:none;">
  <div class="modal-card">
    <div class="modal-title">üîê Save Your Recovery Key</div>
    <p style="font-size:0.75rem;color:#666;line-height:1.7;margin-bottom:1.25rem;">
      This key lets you reset your password if you ever forget it.<br/>
      <strong>Store it somewhere safe</strong> ‚Äî it won't be shown again.
    </p>
    <div class="recovery-key-box" id="recoveryKeyDisplay"></div>
    <button class="btn-copy" id="copyKeyBtn">Copy Key</button>
    <div class="modal-actions" style="margin-top:1.25rem;">
      <button class="btn-save" id="recoveryDoneBtn" style="width:100%;">‚ú¶ I've saved it ‚Äî Continue</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EDIT PHOTO MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="editPhotoModal" class="modal-backdrop" style="display:none;">
  <div class="modal-card wide">
    <div class="modal-title" id="editPhotoTitle">Edit Photo</div>

    <div class="edit-tabs">
      <button class="edit-tab active" data-tab="upload">üìÅ Upload File</button>
      <button class="edit-tab" data-tab="url">üîó Paste URL</button>
    </div>

    <!-- Upload tab -->
    <div class="tab-pane active" id="tab-upload">
      <div class="upload-drop-zone" id="dropZone">
        <input type="file" id="fileInput" accept="image/*" />
        <div class="drop-label">
          <strong>Click or drag &amp; drop an image</strong>
          JPG, PNG, WEBP ‚Äî recommended 800√ó600px or larger
        </div>
      </div>
      <img class="preview-thumb" id="uploadPreview" src="" alt="Preview" />
    </div>

    <!-- URL tab -->
    <div class="tab-pane" id="tab-url">
      <label class="field-label">Image URL</label>
      <input type="text" id="urlInput" class="modal-input" placeholder="https://example.com/photo.jpg" />
      <img class="preview-thumb" id="urlPreview" src="" alt="Preview" style="margin-top:0.75rem;" />
    </div>

    <div style="margin-top:1.25rem;">
      <label class="field-label" for="altInput">Caption / Alt Text</label>
      <input type="text" id="altInput" class="modal-input" placeholder="e.g. Spacious guest bedroom" />
    </div>

    <div class="login-err" id="editPhotoErr" style="margin-top:0.5rem;"></div>

    <div class="modal-actions">
      <button class="btn-reset" id="editPhotoCancelBtn">Cancel</button>
      <button class="btn-save" id="editPhotoSaveBtn">‚ú¶ Apply Photo</button>
    </div>
  </div>
</div>

<script>
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // Budget Homes Admin ‚Äì Password & Price Manager
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  const STORAGE_KEY   = 'bh_prices_v1';
  const AUTH_KEY      = 'bh_auth_v1';   // stores { hash, recoveryHash }

  const DEFAULTS = {
    unit1: { name: 'Unit 1', type: 'Studio Room',     price: 1200, unit: '/night' },
    unit2: { name: 'Unit 2', type: 'Standard Double', price: 1500, unit: '/night' },
    unit3: { name: 'Unit 3', type: 'Deluxe Room',     price: 1800, unit: '/night' },
    unit4: { name: 'Unit 4', type: 'Triple Room',     price: 2200, unit: '/night' },
    unit5: { name: 'Unit 5', type: 'Family Suite',    price: 2500, unit: '/night' },
    pg:    { name: 'PG',     type: 'Paying Guest',    price: 7000, unit: '/month' },
    startingFrom: 1200,
    notes: ''
  };

  // ‚îÄ‚îÄ Crypto helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function sha256(text) {
    const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(text));
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  function generateRecoveryKey() {
    const seg = () => Math.random().toString(36).substring(2, 6).toUpperCase();
    return `${seg()}-${seg()}-${seg()}`;
  }

  // ‚îÄ‚îÄ Auth store ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function getAuthStore() {
    try {
      const raw = localStorage.getItem(AUTH_KEY);
      return raw ? JSON.parse(raw) : null;
    } catch { return null; }
  }

  async function initAuthIfNeeded() {
    // First-ever visit: set default password + generate recovery key
    if (!getAuthStore()) {
      const defaultPw      = 'budgethomes2026';
      const recoveryKey    = generateRecoveryKey();
      const hash           = await sha256(defaultPw);
      const recoveryHash   = await sha256(recoveryKey);
      localStorage.setItem(AUTH_KEY, JSON.stringify({ hash, recoveryHash }));
      // Show the recovery key to the user on first run
      showRecoveryModal(recoveryKey, true);
    }
  }

  async function checkPassword(pw) {
    const store = getAuthStore();
    if (!store) return false;
    return (await sha256(pw)) === store.hash;
  }

  async function checkRecoveryKey(key) {
    const store = getAuthStore();
    if (!store) return false;
    return (await sha256(key)) === store.recoveryHash;
  }

  async function updatePassword(newPw) {
    const store        = getAuthStore();
    store.hash         = await sha256(newPw);
    // Generate a fresh recovery key on every password change
    const newKey       = generateRecoveryKey();
    store.recoveryHash = await sha256(newKey);
    localStorage.setItem(AUTH_KEY, JSON.stringify(store));
    return newKey;
  }

  // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let saved = loadSaved();
  let dirty = false;

  function loadSaved() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : JSON.parse(JSON.stringify(DEFAULTS));
    } catch { return JSON.parse(JSON.stringify(DEFAULTS)); }
  }

  // ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const loginScreen  = document.getElementById('loginScreen');
  const adminPanel   = document.getElementById('adminPanel');
  const loginCard    = document.getElementById('loginCard');
  const resetCard    = document.getElementById('resetCard');
  const pwInput      = document.getElementById('pwInput');
  const loginErr     = document.getElementById('loginErr');

  // ‚îÄ‚îÄ Boot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  (async () => {
    await initAuthIfNeeded();
    if (sessionStorage.getItem('bh_admin_auth') === '1') showPanel();
  })();

  // ‚îÄ‚îÄ Login ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('loginBtn').addEventListener('click', attemptLogin);
  pwInput.addEventListener('keydown', e => { if (e.key === 'Enter') attemptLogin(); });

  async function attemptLogin() {
    const ok = await checkPassword(pwInput.value);
    if (ok) {
      loginErr.textContent = '';
      sessionStorage.setItem('bh_admin_auth', '1');
      showPanel();
    } else {
      loginErr.textContent = 'Incorrect password. Try again.';
      pwInput.value = '';
      pwInput.focus();
    }
  }

  function showPanel() {
    loginScreen.style.display = 'none';
    adminPanel.classList.add('active');
    renderCards();
    renderPreview();
  }

  document.getElementById('logoutBtn').addEventListener('click', () => {
    sessionStorage.removeItem('bh_admin_auth');
    location.reload();
  });

  // ‚îÄ‚îÄ Forgot password flow ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('forgotBtn').addEventListener('click', () => {
    loginCard.style.display = 'none';
    resetCard.style.display = 'block';
  });
  document.getElementById('backToLoginBtn').addEventListener('click', () => {
    resetCard.style.display = 'none';
    loginCard.style.display = 'block';
    document.getElementById('resetErr').textContent = '';
  });

  document.getElementById('doResetBtn').addEventListener('click', async () => {
    const keyVal  = document.getElementById('recoveryInput').value.trim().toUpperCase();
    const newPw   = document.getElementById('newPwInput').value;
    const confirm = document.getElementById('confirmPwInput').value;
    const errEl   = document.getElementById('resetErr');

    if (!keyVal)         { errEl.textContent = 'Please enter your recovery key.'; return; }
    if (newPw.length < 6){ errEl.textContent = 'Password must be at least 6 characters.'; return; }
    if (newPw !== confirm){ errEl.textContent = 'Passwords do not match.'; return; }

    const valid = await checkRecoveryKey(keyVal);
    if (!valid) { errEl.textContent = 'Recovery key is incorrect.'; return; }

    const newKey = await updatePassword(newPw);
    errEl.textContent = '';
    document.getElementById('recoveryInput').value = '';
    document.getElementById('newPwInput').value    = '';
    document.getElementById('confirmPwInput').value= '';
    resetCard.style.display = 'none';
    loginCard.style.display = 'block';
    showRecoveryModal(newKey, false);
  });

  // ‚îÄ‚îÄ Change password (from inside panel) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('changePwBtn').addEventListener('click', () => {
    document.getElementById('cpCurrent').value = '';
    document.getElementById('cpNew').value     = '';
    document.getElementById('cpConfirm').value = '';
    document.getElementById('cpErr').textContent = '';
    document.getElementById('changePwModal').style.display = 'flex';
  });

  document.getElementById('cpCancelBtn').addEventListener('click', () => {
    document.getElementById('changePwModal').style.display = 'none';
  });

  document.getElementById('cpSaveBtn').addEventListener('click', async () => {
    const current = document.getElementById('cpCurrent').value;
    const newPw   = document.getElementById('cpNew').value;
    const confirm = document.getElementById('cpConfirm').value;
    const errEl   = document.getElementById('cpErr');

    if (!(await checkPassword(current))) { errEl.textContent = 'Current password is incorrect.'; return; }
    if (newPw.length < 6)  { errEl.textContent = 'New password must be at least 6 characters.'; return; }
    if (newPw !== confirm)  { errEl.textContent = 'New passwords do not match.'; return; }
    if (newPw === current)  { errEl.textContent = 'New password must be different from current.'; return; }

    const newKey = await updatePassword(newPw);
    document.getElementById('changePwModal').style.display = 'none';
    showRecoveryModal(newKey, false);
  });

  // ‚îÄ‚îÄ Recovery key modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showRecoveryModal(key, isFirstTime) {
    document.getElementById('recoveryKeyDisplay').textContent = key;
    const modal = document.getElementById('recoveryModal');
    const title = modal.querySelector('.modal-title');
    title.textContent = isFirstTime ? 'üîê Welcome! Save Your Recovery Key' : 'üîê New Recovery Key Generated';
    modal.style.display = 'flex';
  }

  document.getElementById('copyKeyBtn').addEventListener('click', () => {
    const key = document.getElementById('recoveryKeyDisplay').textContent;
    navigator.clipboard.writeText(key).then(() => {
      document.getElementById('copyKeyBtn').textContent = '‚úì Copied!';
      setTimeout(() => document.getElementById('copyKeyBtn').textContent = 'Copy Key', 2000);
    });
  });

  document.getElementById('recoveryDoneBtn').addEventListener('click', () => {
    document.getElementById('recoveryModal').style.display = 'none';
  });

  // Close modals on backdrop click
  document.querySelectorAll('.modal-backdrop').forEach(m => {
    m.addEventListener('click', e => { if (e.target === m) m.style.display = 'none'; });
  });

  // ‚îÄ‚îÄ Render price cards ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderCards() {
    const nightlyKeys = ['unit1','unit2','unit3','unit4','unit5'];
    const nightlyGrid = document.getElementById('nightlyGrid');
    const pgGrid      = document.getElementById('pgGrid');

    nightlyKeys.forEach(k => nightlyGrid.appendChild(makeCard(k, false)));
    pgGrid.appendChild(makeCard('pg', true));

    document.getElementById('startingFrom').value = saved.startingFrom || DEFAULTS.startingFrom;
    document.getElementById('adminNotes').value   = saved.notes || '';

    nightlyGrid.querySelectorAll('input').forEach(inp => inp.addEventListener('input', markDirty));
    pgGrid.querySelectorAll('input').forEach(inp => inp.addEventListener('input', markDirty));
    document.getElementById('startingFrom').addEventListener('input', markDirty);
    document.getElementById('adminNotes').addEventListener('input', markDirty);
  }

  function makeCard(key, isPg) {
    const def   = DEFAULTS[key];
    const price = (saved[key] && saved[key].price) || def.price;
    const card  = document.createElement('div');
    card.className = 'price-card' + (isPg ? ' pg-card' : '');
    card.innerHTML = `
      <div class="card-badge">${def.name}</div>
      <div class="card-name">${def.type}</div>
      <div class="card-type">${def.unit.trim()}</div>
      <div class="price-input-wrap">
        <span class="currency-sym">‚Çπ</span>
        <input type="number" id="inp_${key}" value="${price}" min="0" step="50" />
        <span class="price-unit">${def.unit}</span>
      </div>`;
    return card;
  }

  // ‚îÄ‚îÄ Dirty tracking ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function markDirty() {
    dirty = true;
    document.getElementById('saveStatus').textContent = 'You have unsaved changes';
    document.getElementById('statusDot').classList.remove('saved');
  }

  // ‚îÄ‚îÄ Save prices ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('saveBtn').addEventListener('click', saveAll);

  function saveAll() {
    const data = JSON.parse(JSON.stringify(DEFAULTS));
    ['unit1','unit2','unit3','unit4','unit5','pg'].forEach(k => {
      const inp = document.getElementById('inp_' + k);
      if (inp) data[k].price = parseInt(inp.value, 10) || DEFAULTS[k].price;
    });
    data.startingFrom = parseInt(document.getElementById('startingFrom').value, 10) || DEFAULTS.startingFrom;
    data.notes        = document.getElementById('adminNotes').value;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    saved = data;
    dirty = false;
    document.getElementById('saveStatus').textContent = 'All prices saved ¬∑ ' + new Date().toLocaleTimeString();
    document.getElementById('statusDot').classList.add('saved');
    const toast = document.getElementById('saveToast');
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 2800);
    renderPreview();
  }

  // ‚îÄ‚îÄ Reset prices ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('resetBtn').addEventListener('click', () => {
    if (!confirm('Reset all prices to original defaults?')) return;
    ['unit1','unit2','unit3','unit4','unit5','pg'].forEach(k => {
      const inp = document.getElementById('inp_' + k);
      if (inp) inp.value = DEFAULTS[k].price;
    });
    document.getElementById('startingFrom').value = DEFAULTS.startingFrom;
    document.getElementById('adminNotes').value   = '';
    markDirty();
  });

  // ‚îÄ‚îÄ Preview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderPreview() {
    const list = document.getElementById('previewList');
    list.innerHTML = '';
    ['unit1','unit2','unit3','unit4','unit5','pg'].forEach(k => {
      const d  = saved[k] || DEFAULTS[k];
      const el = document.createElement('div');
      el.className = 'preview-item';
      el.innerHTML = `<strong>${d.name} ${d.type}:</strong> <span class="preview-price">‚Çπ${d.price.toLocaleString('en-IN')}${d.unit}</span>`;
      list.appendChild(el);
    });
    const sf = document.createElement('div');
    sf.className = 'preview-item';
    sf.innerHTML = `<strong>Starting from:</strong> <span class="preview-price">‚Çπ${(saved.startingFrom || DEFAULTS.startingFrom).toLocaleString('en-IN')}/night</span>`;
    list.appendChild(sf);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // GALLERY MANAGER
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  const GALLERY_KEY = 'bh_gallery_v1';

  const DEFAULT_GALLERY = [
    { src: 'https://lh3.googleusercontent.com/p/AF1QipNnbypKAq-OR87dILBwelmRJOE2N90kzKrIunbL=s0', alt: 'Spacious guest bedroom' },
    { src: 'https://lh3.googleusercontent.com/p/AF1QipMF3Rk7-43z_Mz-OPrT1uOwUEclgGI4jVCDPqHl=s0', alt: 'Budget Homes exterior front view' },
    { src: 'https://lh3.googleusercontent.com/p/AF1QipMJ--opG4jho3ivfTcc_ESvsOVB3g9SqMT0f1b6=s0', alt: 'Kitchen and dining area' },
    { src: 'https://lh3.googleusercontent.com/p/AF1QipMgkh2egTjMU3CCTrWsZ-WXpjmXnFKA5324GUyB=s0', alt: 'Modern bathroom with amenities' },
    { src: 'https://lh3.googleusercontent.com/p/AF1QipN8PDaZEbjXCN1sqepeeWe2gi_RjN77IGWy8dLi=s0', alt: 'Interior common room' },
    { src: 'https://lh3.googleusercontent.com/p/AF1QipNwWSFtIQVWES5v355o7i1OzONmkJFeuSajs05F=s0', alt: 'Property exterior detail' },
    { src: 'https://lh3.googleusercontent.com/p/AF1QipOtt4B6EYGffzpoMIK9gW3YoiaKjVXxGFElaKY4=s0', alt: 'Entrance and parking area' },
    { src: 'https://lh3.googleusercontent.com/p/AF1QipNtWdil7zQ72fPIISLDNCnGjgGl7XnCyDXtAvFF=s0', alt: 'Room interior setup' },
  ];

  let galleryPhotos = loadGallery();
  let galleryDirty  = false;
  let editingIndex  = -1;   // -1 = new photo
  let pendingSrc    = '';   // staged new src before applying

  function loadGallery() {
    try {
      const raw = localStorage.getItem(GALLERY_KEY);
      return raw ? JSON.parse(raw) : JSON.parse(JSON.stringify(DEFAULT_GALLERY));
    } catch { return JSON.parse(JSON.stringify(DEFAULT_GALLERY)); }
  }

  // ‚îÄ‚îÄ Render gallery grid ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderGalleryGrid() {
    const grid = document.getElementById('galleryAdminGrid');
    grid.innerHTML = '';

    galleryPhotos.forEach((photo, idx) => {
      const card = document.createElement('div');
      card.className = 'gallery-admin-card';
      card.draggable = true;
      card.dataset.idx = idx;

      card.innerHTML = `
        <span class="card-num">Photo ${idx + 1}</span>
        <button class="card-remove" title="Remove photo" data-idx="${idx}">‚úï</button>
        <div class="gallery-thumb-wrap" data-idx="${idx}">
          <img src="${photo.src}" alt="${photo.alt}" loading="lazy" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22150%22><rect width=%22200%22 height=%22150%22 fill=%22%23eee%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23aaa%22 font-size=%2212%22>No image</text></svg>'" />
          <div class="thumb-overlay">Click to edit</div>
        </div>
        <div class="gallery-card-body">
          <span class="gallery-alt-label">Caption</span>
          <input class="gallery-alt-input" type="text" value="${photo.alt}" placeholder="Photo caption‚Ä¶" data-idx="${idx}" />
        </div>
      `;

      grid.appendChild(card);
    });

    // Event listeners
    grid.querySelectorAll('.gallery-thumb-wrap').forEach(wrap => {
      wrap.addEventListener('click', () => openEditModal(parseInt(wrap.dataset.idx)));
    });
    grid.querySelectorAll('.card-remove').forEach(btn => {
      btn.addEventListener('click', e => {
        e.stopPropagation();
        removePhoto(parseInt(btn.dataset.idx));
      });
    });
    grid.querySelectorAll('.gallery-alt-input').forEach(inp => {
      inp.addEventListener('input', () => {
        galleryPhotos[parseInt(inp.dataset.idx)].alt = inp.value;
        markGalleryDirty();
      });
    });

    // Drag-to-reorder
    setupDragReorder(grid);
  }

  // ‚îÄ‚îÄ Drag to reorder ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let dragSrcIdx = null;

  function setupDragReorder(grid) {
    grid.querySelectorAll('.gallery-admin-card').forEach(card => {
      card.addEventListener('dragstart', e => {
        dragSrcIdx = parseInt(card.dataset.idx);
        card.style.opacity = '0.4';
      });
      card.addEventListener('dragend', () => { card.style.opacity = ''; });
      card.addEventListener('dragover', e => { e.preventDefault(); card.style.outline = '2px solid var(--gold)'; });
      card.addEventListener('dragleave', () => { card.style.outline = ''; });
      card.addEventListener('drop', e => {
        e.preventDefault();
        card.style.outline = '';
        const dropIdx = parseInt(card.dataset.idx);
        if (dragSrcIdx === null || dragSrcIdx === dropIdx) return;
        const moved = galleryPhotos.splice(dragSrcIdx, 1)[0];
        galleryPhotos.splice(dropIdx, 0, moved);
        dragSrcIdx = null;
        renderGalleryGrid();
        markGalleryDirty();
      });
    });
  }

  // ‚îÄ‚îÄ Remove photo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function removePhoto(idx) {
    if (galleryPhotos.length <= 1) { alert('You must keep at least one photo.'); return; }
    if (!confirm(`Remove Photo ${idx + 1}?`)) return;
    galleryPhotos.splice(idx, 1);
    renderGalleryGrid();
    markGalleryDirty();
  }

  // ‚îÄ‚îÄ Add photo button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('addPhotoBtn').addEventListener('click', () => openEditModal(-1));

  // ‚îÄ‚îÄ Gallery dirty ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function markGalleryDirty() {
    galleryDirty = true;
    document.getElementById('galleryStatus').textContent = 'You have unsaved gallery changes';
    document.getElementById('galleryStatusDot').classList.remove('saved');
  }

  // ‚îÄ‚îÄ Save gallery ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('gallerySaveBtn').addEventListener('click', () => {
    localStorage.setItem(GALLERY_KEY, JSON.stringify(galleryPhotos));
    galleryDirty = false;
    document.getElementById('galleryStatus').textContent = 'Gallery saved ¬∑ ' + new Date().toLocaleTimeString();
    document.getElementById('galleryStatusDot').classList.add('saved');
    const toast = document.getElementById('saveToast');
    toast.textContent = '‚ú¶ Gallery saved successfully';
    toast.classList.add('show');
    setTimeout(() => { toast.classList.remove('show'); toast.textContent = '‚ú¶ Prices saved successfully'; }, 2800);
  });

  // ‚îÄ‚îÄ Reset gallery ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('galleryResetBtn').addEventListener('click', () => {
    if (!confirm('Reset gallery to original photos?')) return;
    galleryPhotos = JSON.parse(JSON.stringify(DEFAULT_GALLERY));
    renderGalleryGrid();
    markGalleryDirty();
  });

  // ‚îÄ‚îÄ Edit photo modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function openEditModal(idx) {
    editingIndex = idx;
    pendingSrc   = '';

    const modal    = document.getElementById('editPhotoModal');
    const titleEl  = document.getElementById('editPhotoTitle');
    const altInput = document.getElementById('altInput');
    const errEl    = document.getElementById('editPhotoErr');
    const urlInput = document.getElementById('urlInput');

    titleEl.textContent = idx === -1 ? 'Add New Photo' : `Edit Photo ${idx + 1}`;
    altInput.value      = idx === -1 ? '' : (galleryPhotos[idx].alt || '');
    errEl.textContent   = '';
    urlInput.value      = '';

    // Reset previews
    document.getElementById('uploadPreview').classList.remove('show');
    document.getElementById('urlPreview').classList.remove('show');
    document.getElementById('fileInput').value = '';

    // Switch to upload tab by default
    activateTab('upload');

    modal.style.display = 'flex';
  }

  document.getElementById('editPhotoCancelBtn').addEventListener('click', () => {
    document.getElementById('editPhotoModal').style.display = 'none';
  });

  // ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.querySelectorAll('.edit-tab').forEach(tab => {
    tab.addEventListener('click', () => activateTab(tab.dataset.tab));
  });

  function activateTab(name) {
    document.querySelectorAll('.edit-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === name));
    document.querySelectorAll('.tab-pane').forEach(p => p.classList.toggle('active', p.id === 'tab-' + name));
    pendingSrc = '';
  }

  // ‚îÄ‚îÄ File upload / drag-drop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const fileInput = document.getElementById('fileInput');
  const dropZone  = document.getElementById('dropZone');

  fileInput.addEventListener('change', () => handleFile(fileInput.files[0]));

  dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    handleFile(e.dataTransfer.files[0]);
  });

  function handleFile(file) {
    if (!file || !file.type.startsWith('image/')) {
      document.getElementById('editPhotoErr').textContent = 'Please select a valid image file.';
      return;
    }
    const reader = new FileReader();
    reader.onload = e => {
      pendingSrc = e.target.result; // base64 data URL
      const prev = document.getElementById('uploadPreview');
      prev.src = pendingSrc;
      prev.classList.add('show');
      document.getElementById('editPhotoErr').textContent = '';
    };
    reader.readAsDataURL(file);
  }

  // ‚îÄ‚îÄ URL preview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('urlInput').addEventListener('input', function () {
    const val  = this.value.trim();
    const prev = document.getElementById('urlPreview');
    if (val.startsWith('http')) {
      prev.src = val;
      prev.onload  = () => { prev.classList.add('show'); pendingSrc = val; document.getElementById('editPhotoErr').textContent = ''; };
      prev.onerror = () => { prev.classList.remove('show'); pendingSrc = ''; document.getElementById('editPhotoErr').textContent = 'Could not load image from this URL.'; };
    } else {
      prev.classList.remove('show');
      pendingSrc = '';
    }
  });

  // ‚îÄ‚îÄ Apply photo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('editPhotoSaveBtn').addEventListener('click', () => {
    const errEl = document.getElementById('editPhotoErr');
    const alt   = document.getElementById('altInput').value.trim() || 'Budget Homes photo';

    if (!pendingSrc) {
      errEl.textContent = 'Please upload a photo or paste a valid URL first.';
      return;
    }

    if (editingIndex === -1) {
      // Add new
      galleryPhotos.push({ src: pendingSrc, alt });
    } else {
      // Replace existing
      galleryPhotos[editingIndex] = { src: pendingSrc, alt };
    }

    renderGalleryGrid();
    markGalleryDirty();
    document.getElementById('editPhotoModal').style.display = 'none';
  });

  // ‚îÄ‚îÄ Init gallery on panel show ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const _origShowPanel = showPanel;
  // Patch showPanel to also render gallery
  const showPanelOrig = showPanel;
  // We can't easily wrap since showPanel is a declaration, so call renderGalleryGrid
  // from DOMContentLoaded after panel is shown via MutationObserver
  const panelObserver = new MutationObserver(() => {
    if (adminPanel.classList.contains('active')) {
      renderGalleryGrid();
      panelObserver.disconnect();
    }
  });
  panelObserver.observe(adminPanel, { attributes: true, attributeFilter: ['class'] });
</script>
</body>
</html>
